@model CwcExim.Areas.Auction.Models.HDB_AuctionInvoice
<style>
    input[type='number'] {
        -moz-appearance: textfield;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
    }
</style>
<script src="~/Scripts/Extended.Jquery.Plugins.js"></script>
<script src="~/Scripts/clac.js"></script>
@if (ViewBag.StuffingReqList != null)
{
    <input type="hidden" id="hdnStuffingReq" value="@ViewBag.StuffingReqList" />
}
else
{
    <input type="hidden" id="hdnStuffingReq" value="" />
}
@if (ViewBag.PaymentParty != null)
{
    <input type="hidden" id="hdnPartyPayee" value="@ViewBag.PaymentParty" />
}
else
{
    <input type="hidden" id="hdnPartyPayee" value="" />
}
<div id="EMDReceivedForm">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-offset-0-5 col-md-11">
                <div class="Head_h4">
                    @using (Ajax.BeginForm("AddEditAssesmentInvoice", "HDB_AuctionInvoice", new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnSuccessCashRecipt", LoadingElementDuration = 1000, LoadingElementId = "divProgress" }, new { @Id = "EMDReceivedForm" }))
                    {
                        @Html.AntiForgeryToken()

                        <div class="row">
                            <div class="col-md-12">
                                <h4>AUCTION SALES INVOICE</h4>
                            </div>
                        </div>
                        @Html.Hidden("BIDId")
                        @Html.Hidden("PartyId")
                        @Html.HiddenFor(x => x.BidAmount)
                        @Html.HiddenFor(x => x.AdvanceAmount)
                        @Html.HiddenFor(x => x.EmdAmount)
                        @Html.HiddenFor(x => x.BidDate)
                        @Html.Hidden("ContainerJson")
                        @Html.Hidden("hdnAddress")
                        @Html.Hidden("hdnState")
                        @Html.Hidden("hdnStateCode")
                        @Html.Hidden("hdnDeliveryType")
                        @Html.Hidden("InvoiceType")
                        @Html.Hidden("PartySDBalance")
                        @Html.Hidden("PaymentSheetModelJson")
                        @Html.HiddenFor(x => x.InvoiceId)
                        @Html.Hidden("TotalCGST")
                        @Html.Hidden("TotalSGST")
                        @Html.Hidden("TotalIGST")
                        @Html.Hidden("TotalAmt")
                        @Html.Hidden("TotalNoOfPackages")
                        @Html.Hidden("TotalGrossWt")
                        @Html.Hidden("ServiceType")

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Invoice No:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.InvoiceNo, new { @readonly = true })

                                </div>
                                <div class="col-md-1-5 col-md-offset-4 col_cus_offset_3 col_cus_2">
                                    <label>Invoice Date:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5 Date_Img">
                                    @Html.TextBoxFor(m => m.InvoiceDate, new { @readonly = true, Value = DateTime.Today.ToString("dd/MM/yyyy") })

                                </div>
                            </div>
                        </div>



                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>BID No:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.BIDNo, new { @readonly = true })
                                    @Html.ValidationMessageFor(m => m.BIDNo, "", new { @class = "Error_Msg" })
                                    <span class="search" id="SrchInvoiceNo"><i class="fa fa-search" aria-hidden="true" data-toggle="modal" data-target="#BIDNoModal"></i></span>
                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>BOE NO.:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.BOENo)
                                    @Html.ValidationMessageFor(m => m.BOENo, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>BEO Date:</label>
                                </div>
                                <div class="col-md-2-5 Date_Img">
                                    @Html.TextBoxFor(m => m.BOEDate, new { @readonly = true, Value = DateTime.Today.ToString("dd/MM/yyyy") })
                                    @Html.ValidationMessageFor(m => m.BOEDate, "", new { @class = "Error_Msg" })

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Assesment Type:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.DropDownListFor(m => m.AssesmentType, new List<SelectListItem>
                      {
                          new SelectListItem{ Text="LCL", Value = "LCL" },
                          new SelectListItem{ Text="FCL", Value = "FCL" },
                      })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>OBL No.:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.OBL, new { @readonly = true })


                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Shipping Bill No.:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.ShippingBill, new { @readonly = true })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Container No.:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.ContainerNo, new { @readonly = true })

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Cargo Description:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.CargoDescription)
                                    @Html.ValidationMessageFor(m => m.CargoDescription, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Party Name:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.PartyName, new { @readonly = true })

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>HSN Code:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.HSNCode)
                                    @Html.ValidationMessageFor(m => m.HSNCode, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Assesment Sheet Date:</label>
                                </div>
                                <div class="col-md-2-5 A Date_Img">

                                    @Html.TextBoxFor(m => m.AssesmentSheetDate, new { @readonly = true, Value = DateTime.Today.ToString("dd/MM/yyyy") })
                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Free Upto:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5 A Date_Img">
                                    @Html.TextBoxFor(m => m.FreeUpto, new { @readonly = true, Value = DateTime.Today.ToString("dd/MM/yyyy") })
                                    @Html.ValidationMessageFor(m => m.FreeUpto, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>GST(%)</label>
                                </div>
                                <div class="col-md-2-5 A Date_Img">
                                    @Html.TextBoxFor(m => m.GST, new {@onblur= "CalCulateNetPayable()", @class = "numeric", @maxlength = "2" })
                                    @Html.ValidationMessageFor(m => m.GST, "", new { @class = "Error_Msg" })
                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>GST Amount</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5 A Date_Img">
                                    @Html.TextBoxFor(m => m.GstAmt, new { @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.GstAmt, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>


                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>CESS</label>
                                </div>
                                <div class="col-md-2-5 A">
                                    @Html.TextBoxFor(m => m.Cess, new { @onblur = "CalCulateNetPayable()", @class = "numeric", @maxlength = "11" })
                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>TDS Amount</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5 A">
                                    @Html.TextBoxFor(m => m.TDSAmount, new { @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.TDSAmount, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>                        

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Custom Duty:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.CustomDuty, new { @onblur = "CalCulateCWCShare()", @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.CustomDuty, "", new { @class = "Error_Msg" })
                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>OT:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.OT, new { @onblur = "CalCulateCWCShare()", @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.OT, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Valuers Charges:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.ValuersCharges, new { @onblur = "CalCulateCWCShare()", @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.AuctionCharges, "", new { @class = "Error_Msg" })

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Auction Charges:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.AuctionCharges, new { @onblur = "CalCulateNetPayable()", @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.AuctionCharges, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>


                        <div class="row Form_Space_top SignUp_space_bottom2">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>MISC Expenses:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.MISCExpenses, new { @onblur = "CalCulateCWCShare()", @class = "numeric", @maxlength = "11" })
                                    @Html.ValidationMessageFor(m => m.AuctionCharges, "", new { @class = "Error_Msg" })

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>CWC Share:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.CWCShare, new { @readonly = true })
                                </div>
                            </div>
                        </div>
                        <div class="row Form_Space_top SignUp_space_bottom2">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>EMD Adjustment:</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.TextBoxFor(m => m.EmdAdj,new {@onblur = "CalCulateNetPayable()", @class = "numeric", @maxlength = "11" })
                                    

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Advance Adjustment:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.AdvAdj, new { @onblur = "CalCulateNetPayable()", @class = "numeric", @maxlength = "11" })
                                </div>
                            </div>
                        </div>
                        <div class="row Form_Space_top SignUp_space_bottom2">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Delivery Valid Upto:</label>
                                </div>
                                <div class="col-md-2-5 A Date_Img">
                                    @Html.TextBoxFor(m => m.DeliveryDateUpto, new { @readonly = true, Value = DateTime.Today.ToString("dd/MM/yyyy") })

                                </div>
                                <div class="col-md-1-5 col_cus_2 col_cus_offset_3 col-md-offset-4">
                                    <label>Net Amount Payable:</label>
                                </div>
                                <div class="col-md-2 col_cus_2_5">
                                    @Html.TextBoxFor(m => m.NetPayable, new { @readonly = true })
                                </div>
                            </div>
                        </div>
                        <div class="row Form_Space_top SignUp_space_bottom2">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5">
                                    <label>SEZ</label>
                                </div>
                                <div class="col-md-2-5">
                                    @Html.DropDownList("SEZ1", new List<SelectListItem>
                                        {
                                        new SelectListItem { Text="SEZWP",Value="SEZWP"},
                                        new SelectListItem {Text="SEZWOP",Value="SEZWOP" }

                                        }, "---Select---", new { @class = "form-control input-sm dropdown" })
                                    @Html.ValidationMessage("SEZ1", new { @class = "Error_Msg" })
                                </div>
                                @Html.HiddenFor(x => x.SEZ)
                            </div>
                        </div>

                        <div class="row SignUp_space_bottom SignUp_space_top">
                            <div class="stoke"></div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2">
                                    <label>Remarks:</label>
                                </div>
                                <div class="col-md-10-5 col_cus_10">
                                    @*@Html.TextAreaFor(m => m.Remarks, new { @style = "height:75px;" })*@
                                    @Html.TextArea("Remarks", new { @style = "height:75px;", @maxlength = "500" })
                                </div>
                            </div>
                        </div>
                        <div class="Head_h5">
                            <div class="row">
                                <div class="col-md-12">
                                    <h5>Pay Details</h5>
                                </div>
                            </div>
                            <div class="row SignUp_space_top2 SignUp_space_bottom2">
                                <div class="col-md-12">
                                    <table id="TblPaymentMode" class="table-striped table-bordered nowrap dataTable no-footer" cellspacing="0" width="100%">
                                        <thead>
                                            <tr>
                                                <th>Mode</th>
                                                <th>Drawee Bank</th>
                                                <th>Instrument No</th>
                                                <th>Date</th>
                                                <th>Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @for (var i = 0; i < 6; i++)
                                            {
                                                <tr>
                                                    <td>@Html.DropDownListFor(m => m.CashReceiptDetail[i].PaymentMode, (SelectList)ViewBag.PaymentMode)</td>
                                                    <td>@Html.TextBoxFor(m => Model.CashReceiptDetail[i].DraweeBank)<span>@Html.ValidationMessageFor(m => Model.CashReceiptDetail[i].DraweeBank, "", new { @class = "Error_Msg", @style = "text-align:left;" })</span></td>
                                                    <td>@Html.TextBoxFor(m => Model.CashReceiptDetail[i].InstrumentNo)<span>@Html.ValidationMessageFor(m => Model.CashReceiptDetail[i].InstrumentNo, "", new { @class = "Error_Msg", @style = "text-align:left;" })</span></td>
                                                    <td class="Datetab Datetab_Img">@Html.TextBoxFor(m => Model.CashReceiptDetail[i].Date, new { @placeholder = "dd/mm/yyyy" })</td>
                                                    <td class="Table_right">@Html.TextBoxFor(m => Model.CashReceiptDetail[i].Amount, new { @Value = "", @type = "number", @style = "width:100%;text-align:right;" })<span>@Html.ValidationMessageFor(m => Model.CashReceiptDetail[i].Amount, "", new { @class = "Error_Msg", @style = "text-align:left;" })</span></td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row SignUp_space_bottom SignUp_space_top">
                            <div class="stoke"></div>
                        </div>
                        <div class="logSuccMsg Form_Space_bottom" id="DivPaySheetCargoMsg" style="background-color:transparent"></div>
                        <div class="row SignUp_space_bottom2">
                            <div class="col-md-2">
                                <button type="button" class="btn log_Btn_sm" id="btnSave" onclick="return ValidateSave()">Save</button>
                            </div>
                            <div class="col-md-2">
                                <input type="button" value="Reset" class="btn log_Btn_sm" onclick="ResetField()" />
                            </div>
                            <div class="col-md-3">
                                <input type="button" id="BtnGenerateIRN" class="btn log_Btn_sm" value="Generate IRN" onclick="GenerateIRN()" disabled="disabled" />
                            </div>
                            <div class="col-md-2">
                                <input type="button" value="Print" class="btn log_Btn_sm" onclick="Print()" id="btnPrint" disabled />
                            </div>
                        </div>
                    }
                        <div class="row SignUp_space_bottom SignUp_space_top">
                            <div class="col-md-2">
                                <button type="submit" class="btn log_Btn_sm" onclick="ShowList()">Show All</button>
                            </div>
                        </div>
                        <div class="row SignUp_space_bottom SignUp_space_top">
                            <div id="Sholist"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
                  
                </div>
@Scripts.Render("~/bundles/jqueryval")
<div class="modal fade" id="BIDNoModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content popup_modal">
            <div class="modal-header popup_header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times" aria-hidden="true"></i></button>
                <h4 class="modal-title">Choose BID No</h4>
            </div>
            <div class="modal-body popup_body">
                <input placeholder="Search Me" id="CHAbox" type="text" />
                @if (ViewBag.EMDReceivedList != null)
                {
                    <ul class="navList" id="lstInvoice">
                        @foreach (var item in ViewBag.EMDReceivedList)
                        {
                            <li id="@item.BIDId">@item.BIDNo</li>
                        }
                    </ul>
                }
                else
                {
                    <ul class="navList" id="lstInvoice">
                        <li></li>
                    </ul>
                }
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-md-offset-6 col-md-6">
                        <button type="button" class="btn log_Btn_sm" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var TimeInSeconds;
    $(document).ready(function () {
        TimeInSeconds = 5000;
        $("#InvoiceDate").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });
        $("#FreeUpto").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });
        $("#BOEDate").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });
        $("#DeliveryDateUpto").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });

        $("#AssesmentSheetDate").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });

        for (var i = 0; i < 6; i++) {
            var date = new Date();
            var currentMonth = date.getMonth();
            var currentDate = date.getDate();
            var currentYear = date.getFullYear();
            $('#CashReceiptDetail_' + i + '__Date').datepicker({
                dateFormat: "dd/mm/yy",
                showOn: "button",
                buttonImage: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjg0RThEQzY5NjVFNjExRTY5QkM2QzI0NEJEOEU1MTQ1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjg0RThEQzZBNjVFNjExRTY5QkM2QzI0NEJEOEU1MTQ1Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODRFOERDNjc2NUU2MTFFNjlCQzZDMjQ0QkQ4RTUxNDUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6ODRFOERDNjg2NUU2MTFFNjlCQzZDMjQ0QkQ4RTUxNDUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4K6/yIAAAEK0lEQVR42qRVXWhcRRQ+Z2bu3t3sbrU1qSUSlZJiSbWgYkF9U/CheYnUN4VCUfC1BQUVUUQUHyyIhdLHPPikYH0JpAEVX0RDhYooikTQiAbrT5vs3d37c47f3Lu72WZ/Ijjs7MydOf/fOWdYVSksV2jm0F1UnZqksNkilraJbeU9JZ63lk4S6YckTOonMQWUkNPURCZcJOYFMXpKWN+3GVMpcZSEQlp2dGVlhQztGBlZCAn3E5sFZq5nwo9nYnLhfngVqVqKXbCXmU7gtGaFTpRicHZo+ofr/8D1fpBVSI2FIPiWDzXKZSwzfu/JQNNMrRWbSXGipJylNXXBNL42MTcgTDxz7sFErX6ntfYtjuU3MvIlhM+Cr9XR2xRJ7lNDP2B+41djZNmo3AbB7cIyjimozOPu+zTIfobGC5zK0Z4HB+fueVlEnkQcvMIwKFGcaWEBiTTSaJODPfvApyEVbpSwSWJWbzthiQQrFRFyLPS0NtM7sH8s9yBLkrkuM2hukoxCgPoC2C8aSS64Sv0wdQNW4DDTDJwVpTMq+lG7HJyHaYdvCL7hQ70QeTv779pMZwHgOrO8KkF4P7vgjRuYmUNuZe9A5RoMf8XF2TGj9NwOPAdB3uanOfi+hJ2yz0vSARrk1cO4+tTfIURMTEOHo7GDeeyt/40nGapgE/h+Dpuv9ULIpoC2iwN3nep5Bgi4iosHsd87XoHoOdj1Yr/L0twi4EAG6ZV/J8hOdsQoc+4o4bwe5LSyOdvPO6AAxfht4TZii1WiLcqiBrmJ2nEOygs5UZJcJMtLbINnQXHEnwCGd5X5a7A08F0d7UFHu8e2gshU6jVSzJbwQy3RZ/xdtVrfSEWXYpEn2PCjObmhS/hvDSbDSACZErgjPDJBRvHzrlnUpUgR1wY65O2TwG2rudzabMZ5a6lOfBylKbVb8XnE/lLeI5mvILXvHptFveZWVN4Bn4aJaOuX9fW/xQaXyYbfeYJ/rl+L1DBZ45ZRzR55Xwl/QtnRXV2E0AT/D2BdwlwBwWtBgAwy9iQs/MJPi71h32/pTbB8grkM4cco592lDgxaJYin0Kzv7SjcqJTRrTOdThI96M+CwE0n6Iaa6RFjqBMWnUQEovHvAaxqRRE56yJXKv0FJSHm1TiJId80i4KDrixDC88T4So+fVr67Imo+zqMUmCdoz9+/7Veq9/8wS2Ttx4XyYyPbaOdeWmLCNNnng7p+RNcRcPklwDW23lTN7yKt3Ye6e14lAJBZkwdmH7KuNIq3oe1vLcrW7Jl33pRvvpjEUdf0joLW731171TMHsW/p3y78mAB7DS5LUL1MoTtUew+Qp72c7ond10aHeFfA6GYoCbVSwerJpK/jQE9D+Gb4sienk7RIZeh8FrcOB53O4ZauJ/G0hAbVZK4bl99eqiP/hXgAEAGxXRtLB4dQoAAAAASUVORK5CYII=",
                buttonImageOnly: true,
                buttonText: "Select date",
                changeMonth: true,
                changeYear: true,
                // maxDate: new Date(currentYear, currentMonth, currentDate),
                // minDate: 0,
                showAnima: "fadein",
                onClose: function () {
                }
            });
        }


        //StuffingReqBinding();
        //PartyBinding();
        //PayeeBinding();
        $('.numeric').ForceNumeric();
    });

    $('#lstInvoice > li').on("click", function () {

        $('#BIDId').val($(this).attr('id'));
        $('#BIDNo').val($(this).text())
        var bidid = $('#BIDId').val();
        $("#BIDNoModal").modal("hide");

        if (bidid > 0) {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetBidDetails", "HDB_AuctionInvoice")',
                data: { BIDId: bidid },
                success: function (data) {
                    debugger;
                    if (data != undefined || data != null) {

                            $("#BIDNo").val(data.BIDNo);
                            $("#OBL").val(data.OBL);
                            $("#ShippingBill").val(data.ShippingBill);
                            $("#ContainerNo").val(data.ContainerNo);
                            $("#PartyName").val(data.PartyName);
                            $("#GSTNo").val(data.GSTNo);
                            $("#Sate").val(data.Sate);
                            $("#BidAmount").val(data.BidAmount);
                            $('#CWCShare').val(data.BidAmount);
                            $("#PartyId").val(data.PartyId);
                            $("#hdnAddress").val(data.PartyAddress);
                            $("#PartyName").val(data.PartyName);
                            $("#hdnState").val(data.State);
                            $("#hdnStateCode").val(data.StateCode);
                            $("#InvoiceType").val(data.InvoiceType);
                            $("#InvoiceId").val(data.InvoiceId);
                            $('#BidDate').val(data.BidDate);

                            $('#EmdAmount').val(data.EmdAmount);
                            $('#AdvanceAmount').val(data.AdvanceAmount);
                            $("#NetPayable").val(data.BidAmount);

                            $('#CustomDuty').val('');
                            $('#OT').val('');
                            $('#AuctionCharges').val('');
                            $('#MISCExpenses').val('');
                            $('#ValuersCharges').val('');

                    }
                    else {
                        $('#BIDId').val(0);
                        $("#BIDNo").val("");
                        $("#ReceiptDate").val("");
                        $("#PartyName").val("");
                        $("#GSTNo").val("");
                        $("#Sate").val("");
                        $("#InvoiceId").val(0);
                    }
                },
                error: function () {
                }
            });
        }
    });

    function CalCulateCWCShare()
    {

        debugger;
        var BidAmount = $('#BidAmount').val() == "" ? 0 : $('#BidAmount').val();
        var CustomDuty = $('#CustomDuty').val() == "" ? 0 : $('#CustomDuty').val();
        var Ot = 0;
        var ValuersCharges = $('#ValuersCharges').val() == "" ? 0 : $('#ValuersCharges').val();
        var AuctionCharge = $('#AuctionCharges').val() == "" ? 0 : $('#AuctionCharges').val();
        var Misc = $('#MISCExpenses').val() == "" ? 0 : $('#MISCExpenses').val();

        var CwcSHare = (parseFloat(BidAmount) - (parseFloat(CustomDuty) + parseFloat(Ot) + parseFloat(ValuersCharges) + parseFloat(AuctionCharge) + parseFloat(Misc)))
        $('#CWCShare').val(CwcSHare);

    }


    function CalCulateNetPayable() {

        debugger;
        var BidAmount = $('#BidAmount').val() == "" ? 0 : $('#BidAmount').val();
        var Gst=$('#GST').val() == "" ? 0 : $('#GST').val();
        var AuctionCharges = $('#AuctionCharges').val() == "" ? 0 : $('#AuctionCharges').val();
        var Cess = $('#Cess').val() == "" ? 0 : $('#Cess').val();

      //  var AdvanceAmount = $('#AdvanceAmount').val() == "" ? 0 : $('#AdvanceAmount').val();
        //  var EmdAmount = $('#EmdAmount').val() == "" ? 0 : $('#EmdAmount').val();
        var EmdAdj = $('#EmdAdj').val() == "" ? 0 : $('#EmdAdj').val();
        var AdvAdj = $('#AdvAdj').val() == "" ? 0 : $('#AdvAdj').val();

       /* var totalAdvance = 0;
        if (parseFloat(AdvanceAmount) > parseFloat(EmdAmount))
        {
            totalAdvance = AdvanceAmount;

        }
        else
        {
            totalAdvance = EmdAmount;
        }*/

        var TotalGst = Math.ceil(BidAmount * Gst / 100);
        var NetPayable = (parseFloat(BidAmount) + parseFloat(TotalGst) +parseFloat(Cess)- parseFloat(EmdAdj) - parseFloat(AdvAdj));
        $('#NetPayable').val(NetPayable);
        $('#GstAmt').val(TotalGst);
        CalCulateCWCShare();
     

    }

    function ValidateSave() {

        debugger;

       

        var isErrorFound = false;
        $('#TblPaymentMode tbody tr').each(function (i) {
            if (!isErrorFound) {
                var tblAmnt = parseInt($(this).find('td').eq(4).children('input[type="number"]').val());
                if (tblAmnt > 0) {
                    var mode = $(this).find('td').eq(0).children('select').val();
                    if (mode == "") {
                        isErrorFound = true;
                        alert("Please select the mode of Payment Details");
                        return false;
                    }
                }
            }
        });

        if (isErrorFound) {
            return false;
        }

        var TotColmAmnt = 0;

        $('#TblPaymentMode tbody tr').each(function (i) {
            var tblAmnt = $(this).find('td').eq(4).children('input[type="number"]').val();
            if (tblAmnt != undefined || tblAmnt != "") {
                var Amount = Number(tblAmnt);
                TotColmAmnt += Amount;
            }
        });

        if (TotColmAmnt != (parseFloat($('#NetPayable').val()))) {
            alert("Net Payable Amount is not same as Receipt Amount.");
            return false;
        }
        else {
            try {
                $('#BtnSave').attr('disabled');
                $('form#EMDReceivedForm').submit();

            }
            catch (e) {
                $('#btnSave').removeAttr('disabled');
            }
        }

    }

    $('#SEZ1').change(function () {

        if ($('#SEZ1').val() == 'SEZWOP') {
            $('#GST').val(0);
            CalCulateNetPayable();
            $('#SEZ1').attr("disabled", 'disabled');

        }

        $('#SEZ').val($('#SEZ1').val());

    });
    function OnSuccessCashRecipt(data) {
        debugger
        if (data.Status == 1) {
            $('#DivPaySheetCargoMsg').html("Auction Invoice saved successfully.");
            $('#btnPrint').removeAttr('disabled');
            $('#btnSave').attr('disabled', true);
            //$('#InvoiceNo').val(data.Data);
            var AppValues = data.Data.split(",")
            $('#InvoiceNo').val(AppValues[0]);
            $('#ServiceType').val(AppValues[1]);
            $('#BtnGenerateIRN').removeAttr('disabled');
        }
        else {
            if ($('#DivPaySheetCargoMsg').hasClass('logSuccMsg'))
                $('#DivPaySheetCargoMsg').removeClass('logSuccMsg').addClass('logErrMsg');
            $('#DivPaySheetCargoMsg').html(data.Message);
        }
    }


</script>
<script>
    function ShowCharges() {
        debugger;
        if ($('#HSNCode').val() != "") {
            $('span[data-valmsg-for="HSNCode"]').removeClass('field-validation-error');
            $('span[data-valmsg-for="HSNCode"]').text('');
            var InvoiceDate = $('#InvoiceDate').val();
            var BidDate = $('#BidDate').val();

            var dtInvoiceDate = new Date(InvoiceDate.split('/')[2] + '-' + InvoiceDate.split('/')[1] + '-' + InvoiceDate.split('/')[0]);
            var dtBidDate = new Date(BidDate.split('-')[2] + '-' + BidDate.split('-')[1] + '-' + BidDate.split('-')[0]);

            if (dtInvoiceDate < dtBidDate) {
                alert("Delivery Date should be greater than BID Date.");
                return false;
            }


            if ($('#InvoiceDate').val() != "" && $('#BIDId').val() > 0) {

                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("GetAuctionCharges", "HDB_AuctionInvoice")',
                    data: {
                        BIDId: $('#BIDId').val(),
                        InvoiceId: $('#InvoiceId').val(),
                        InvoiceDate: $('#InvoiceDate').val(),
                        FreeUpTo: $('#FreeUpto').val(),
                        HSNCode: $('#HSNCode').val(),
                        CustomDuty: $('#CustomDuty').val(),
                        OT: $('#OT').val(),
                        ValuersCharge: $('#ValuersCharges').val(),
                        AuctionCharge: $('#AuctionCharges').val(),
                        MISC: $('#GST').val(),

                    },
                    success: function (data) {
                        debugger;
                        if (data != null && data != 'undefined') {
                            $('#TotalCGST').val(data.TotalCGST);
                            $('#TotalSGST').val(data.TotalSGST);
                            $('#TotalIGST').val(data.TotalIGST);
                            $('#PartySDBalance').val(data.PartySDBalance);
                            $('#TotalNoOfPackages').val(data.TotalNoOfPackages);
                            $('#TotalGrossWt').val(data.TotalGrossWt);

                            $('#PaymentSheetModelJson').val(data.PaymentSheetModelJson);
                            var rawJson = JSON.parse($('#PaymentSheetModelJson').val());
                            html = '';

                            $.each(rawJson, function (i, item) {

                                html += '<tr><td>' + item.ChargeName + '</td>'
                                             + '<td><input class="text-right" id="' + item.ChargeId + '" type="text" value="' + item.Amount.toFixed(2) + '" readonly /></td>'
                                             + '<td><input class="text-right" id="IGSTP' + item.ChargeId + '" type="text" value="' + item.IGSTPer + '"  readonly /></td>'
                                             + '<td><input class="text-right" id="IGSTA' + item.ChargeId + '" type="text" value="' + item.IGSTAmt.toFixed(2) + '" readonly /></td>'
                                             + '<td><input class="text-right" id="CGSTP' + item.ChargeId + '" type="text" value="' + item.CGSTPer + '"  readonly /></td>'
                                             + '<td><input class="text-right" id="CGSTA' + item.ChargeId + '" type="text" value="' + item.CGSTAmt.toFixed(2) + '" readonly /></td>'
                                             + '<td><input class="text-right" id="SGSTP' + item.ChargeId + '" type="text" value="' + item.SGSTPer + '"  readonly /></td>'
                                             + '<td><input class="text-right" id="SGSTA' + item.ChargeId + '" type="text" value="' + item.SGSTAmt.toFixed(2) + '" readonly /></td>'
                                             + '<td><input class="text-right" id="TOT' + item.ChargeId + '" type="text" value="' + Math.ceil(item.Total) + '" readonly /></td></tr>';

                            });
                            $('#tblCWCCharges tbody').html(html);
                            $('#SrchInvoiceNo').addClass('hidden');

                            $('#InvoiceDate').attr('readonly', true);
                            $('#HSNCode').attr('readonly', true);
                            $('#SrchInvoiceNo').addClass('hidden');
                            $('#BOENo').attr('readonly', true);
                            $('#BOEDate').attr('readonly', true);
                            $('#AssesmentType').attr('disabled', true);
                            $('#CargoDescription').attr('readonly', true);
                            $('#HSNCode').attr('readonly', true);
                            $('#AssesmentSheetDate').attr('readonly', true);
                            $('#FreeUpto').attr('readonly', true);
                            $('#CustomDuty').attr('readonly', true);
                            $('#OT').attr('readonly', true);
                            $('#AuctionCharges').attr('readonly', true);
                            $('#MISCExpenses').attr('readonly', true);
                            $('#BOEDate').parent().find('img').css('display', 'none');
                            $('#AssesmentSheetDate').parent().find('img').css('display', 'none');
                            $('#InvoiceDate').parent().find('img').css('display', 'none');
                            $('#FreeUpto').parent().find('img').css('display', 'none');
                            $('#DeliveryDateUpto').parent().find('img').css('display', 'none');




                            $('#Weight').attr('readonly', true);
                            $('#FOB').attr('readonly', true);
                            CalcInvoice();
                            $('#btnSave').removeAttr('disabled');

                            $('.search').css('display', 'none');
                            $('#InvoiceDate').parent().find('img').css('display', 'none');
                        }
                        else {
                            $('#PaymentSheetModelJson').val('');
                            $('#tblCWCCharges tbody').html('');
                            $('#TOTHTChrg').val('');
                            $('#AllTotal').val('');
                            $('#RoundUp').val('');
                        }
                    }
                });
            }
        }
        else
        {
            debugger;
            $('span[data-valmsg-for="HSNCode"]').addClass('field-validation-error');
            $('span[data-valmsg-for="HSNCode"]').text('The HSN Code field is required.');

        }
    }


    function BindJson() {
        debugger;
        //if ($('#PartyId').val() > 0) {
        //    if (parseFloat($('#PartySDBalance').val()) < parseFloat($('#InvoiceValue').val())) {
        //        alert("This Party has insufficient SD Balance to save the Invoice.");
        //        return false;
        //    }
        //}
        var conf = confirm("Do you want to save ?");
        if (conf) {
            try {
                $('#btnSave').attr('disabled', true);
                var rawJson = {};
                rawJson.InvoiceId = $("#InvoiceId").val();
                rawJson.InvoiceDate = $('#InvoiceDate').val();
                rawJson.BIDId = $('#BIDId').val();
                rawJson.BIDNo = $('#BIDNo').val();
                rawJson.ReceiptDate = $('#ReceiptDate').val();
                rawJson.PartyId = $('#PartyId').val();
                rawJson.PartyName = $('#PartyName').val();
                rawJson.PayeeId = $('#PartyId').val();
                rawJson.PayeeName = $('#PartyName').val();
                rawJson.TotalNoOfPackages = $('#TotalNoOfPackages').val();
                rawJson.TotalGrossWt = $('#TotalGrossWt').val();
                rawJson.AllTotal = parseFloat($('#AllTotal').val());
                rawJson.TotalCGST = parseFloat($('#TotalCGST').val());
                rawJson.TotalSGST = parseFloat($('#TotalSGST').val());
                rawJson.TotalIGST = parseFloat($('#TotalIGST').val());
                rawJson.TotalAmt = parseFloat($('#TotalAmt').val());
                rawJson.RoundUp = parseFloat($('#RoundUp').val());
                rawJson.InvoiceValue = parseFloat($('#InvoiceValue').val());
                rawJson.Remarks = $('#Remarks').val();
                rawJson.PaymentSheetModelJson = $('#PaymentSheetModelJson').val();
                rawJson.HSNCode = $('#HSNCode').val();
                rawJson.GST = $('#GST').val();

                rawJson.BOENo = $('#BOENo').val();
                rawJson.BOEDate = $('#BOEDate').val();
                rawJson.AssesmentType = $('#AssesmentType').val();
                rawJson.OBL = $('#OBL').val();
                rawJson.ShippingBill = $('#ShippingBill').val();
                rawJson.CargoDescription = $('#CargoDescription').val();
                rawJson.AssesmentSheetDate = $('#AssesmentSheetDate').val();
                rawJson.FreeUpto = $('#FreeUpto').val();
                rawJson.CustomDuty = $('#CustomDuty').val();
                rawJson.OT = $('#OT').val();
                rawJson.ValuersCharges = $('#ValuersCharges').val();
                rawJson.AuctionCharges = $('#AuctionCharges').val();
                rawJson.MISCExpenses = $('#MISCExpenses').val();
                rawJson.CWCShare = $('#CWCShare').val();
                rawJson.ContainerNo = $('#ContainerNo').val();
                rawJson.DeliveryDateUpto = $('#DeliveryDateUpto').val();




                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    type: 'POST',
                    url: '/Auction/HDB_AuctionInvoice/AddEditInvoice',
                    data: JSON.stringify(rawJson),
                    dataType: 'JSON',
                    success: function (data) {
                        if (data.Status == 1 || data.Status == 2) {
                            if ($('#DivPaySheetCargoMsg').hasClass('logErrMsg'))
                                $('#DivPaySheetCargoMsg').removeClass('logErrMsg').addClass('logSuccMsg');
                            var AppValues = data.Data.split(",")
                            $('#InvoiceNo').val(AppValues[0]);
                            $('#ServiceType').val(AppValues[1]);
                            $('#BtnGenerateIRN').removeAttr('disabled');
                           
                            $('#btnPrint').removeAttr('disabled');
                            $('#BtnSave').attr('disabled', true);
                        }
                        else if (data.Status == 3)
                        {
                            $('#DivPaySheetCargoMsg').html("Invoice can not be generated. SD Balance is low");
                          //  $('#btnPrint').removeAttr('disabled');
                        }
                        else {
                            if ($('#DivPaySheetCargoMsg').hasClass('logSuccMsg'))
                                $('#DivPaySheetCargoMsg').removeClass('logSuccMsg').addClass('logErrMsg');
                            $('#DivPaySheetCargoMsg').html(data.Message);
                        }
                    }
                });


            }
            catch (e) {
                $('#btnSave').removeAttr('disabled');
            }
        }
    }


    $('#CHAbox').keyup(function () {
        var val = $(this).val().toLowerCase();
        if (val == "")
            $('#lstInvoice > li').show();
        else {
            $('#lstInvoice > li').each(function () {
                var text = $(this).text().toLowerCase();
                (text.indexOf(val) >= 0 ? $(this).show() : $(this).hide());
            });
        }
    });



</script>
<script>

    function ResetField() {
        debugger;
        $('#DivBody').load('/Auction/HDB_AuctionInvoice/CreateAuctionInvoice');
    }

    function ShowList() {
        debugger;
        $('#Sholist').load('/Auction/HDB_AuctionInvoice/GetAssessmentList');
    }
</script>
<script>

    function Print() {

        var Token = $('input[name="__RequestVerificationToken"]').val();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetAssessmentSheetReport", "HDB_AuctionInvoice", new { area = "Auction" })',
            headers: { "__RequestVerificationToken": Token },
            data: {
                InvoiceNo: $('#InvoiceNo').val()
              
            },
            dataType: 'JSON',
            success: function (data) {
                debugger;
                window.open(data.Data + '?t=' + (new Date().getTime()), "_blank", "fullscreen=yes");
            }
        });

    }


    function PrintInvoice(InvoiceNo) {
        debugger;
        var Token = $('input[name="__RequestVerificationToken"]').val();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetAssessmentSheetReport", "HDB_AuctionInvoice", new { area = "Auction" })',
            headers: { "__RequestVerificationToken": Token },
            data: {
                InvoiceNo: InvoiceNo

            },
            dataType: 'JSON',
            success: function (data) {
                debugger;
                window.open(data.Data + '?t=' + (new Date().getTime()), "_blank", "fullscreen=yes");
            }
        });

    }

    function GenerateIRN() {
        debugger;
        $.ajax({
            url: '/Auction/HDB_AuctionInvoice/GetIRNForYardInvoice',
            type: 'POST',
            data: { InvoiceNo: $('#InvoiceNo').val(), SupplyType: $('#ServiceType').val() },
            // headers:{"__RequestVerificationToken":Token},
            dataType: 'JSON',
            success: function (data) {

                alert(data.Message);
            }
        });
    }

</script>
