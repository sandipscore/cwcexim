@model CwcExim.Areas.Export.Models.SpecialOperationReq

@{
    AjaxOptions options = new AjaxOptions();
    options.Confirm = "Are You Sure You Want To Save?";
    options.HttpMethod = "POST";
    options.OnSuccess = "GateExitOnSuccess";
    options.OnFailure = "GateExitOnFailure";
    options.InsertionMode = InsertionMode.InsertAfter;
}
<script type="text/javascript">
    var TimeInSeconds;
    $(document).ready(function () {
        $('#ContainerNoSearch').hide();
        TimeInSeconds = 3000;
        $('#DivExitThroughGateMsg').html('');
        $('#PermissionDate').blur(function () {
            debugger;
            var s = $('#PermissionDate').val();
            var dateRegex = new RegExp("^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$");
            if (!dateRegex.test(s)) {
                $("#errmsg2").html("date format not valid");
                //$("#errmsg2").css("display","block");
            } else {
                $("#errmsg2").html("");
            }
        });


    });

    function GetExitThroughGateList() {
        debugger;
        //$('#DivGateExitList').load('/GateOperation/kol_CWCGateExit/EntryThroughGateList');
        var Token = $('input[name="__RequestVerificationToken"]').val();
        $.ajax({
            url: '/GateOperation/Ppg_GateExit/getExitHeaderList',
            type: 'GET',
            headers: { '__RequestVerificationToken': Token },
            dataType: 'text',
            async: false,
            success: function (data) {
                // alert(data);
                if (data != null && data != "" && data != undefined) {
                    $("#DivGateExitList").html('');
                    $("#DivGateExitList").html(data);
                }
                else {
                    $("#DivGateExitList").html('');

                }
            }
        });
    }


</script>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-offset-0-5 col-md-11">
            <div class="Head_h4">

                @using (Ajax.BeginForm("AddEditSpecialOperationreq", "Dnode_CWCSpcloperationReq", options))
                {
                    //@Html.AntiForgeryToken()
                    // @Html.HiddenFor(m => m.StrExitThroughGateDetails)
                    // @Html.HiddenFor(m => m.GatePassId)
                    @*@Html.HiddenFor(m=>m.CFSCode);*@
                    //@Html.HiddenFor(m => m.BranchId)
                    <input type="hidden" id="ViewMode" name="ViewMode" value=@ViewBag.ViewMode />
                    <input type="hidden" id="txtCFSCode" name="txtCFSCode" />

                    <input type="hidden" id="txtOperationType" name="OperationType" />
                    @*if(ViewBag.LstcontainerJson != null)
                        {
                         <input type="hidden" id="LstcontainerJson" value="@ViewBag.LstcontainerJson.ToString()" />
                         }
                         else
                         {*@
                    <input type="hidden" id="LstcontainerJson" value="" />
                    @*}*@
                    @Html.HiddenFor(m => m.ShippingLineid, new { @id = "ShippingLineid" })
                    // <input type="hidden" id="shippingLineId" name="shippingLineId" />

                    @*if (ViewBag.HeaderId != null && @ViewBag.HeaderId > 0)
                        {
                            <input type="hidden" id="ViewIdOfHdr" name="ViewIdOfHdr" value=@ViewBag.HeaderId />
                        }*@
                    @*<input type="hidden"   id="GatePassId" name="GatePassId">*@
                    <div class="row">
                        <div class="col-md-12">
                            <h4>Special Operation Request</h4>
                        </div>
                    </div>
                    <div class="row Form_Space_top">
                        <div class="form-group Form_Input">
                            <div class="col-md-1-5 col_cus_2">
                                <label>Special Operation</label>
                            </div>
                            <div class="col-md-2-5">

                                @Html.TextBoxFor(m => m.SpclOprtnReqNo, new { @class = "form-control input-sm", @readonly = "true", @id = "SpclOprtnReqNo" })
                                @Html.ValidationMessageFor(m => m.SpclOprtnReqNo, "", new { @class = "Error_Msg" })
                            </div>
                            <div class="col-md-1-5 col-md-offset-4-5 col_cus_1 col_cus_offset_5 padding_rt">
                                <label> Date:</label>
                            </div>
                            <div class="col-md-2 col_cus_2_5 Date_Img">
                                @Html.TextBoxFor(m => m.ReqDate, new { @class = "form-control", @id = "ReqDate", placeholder = "dd/mm/yyyy", Value = DateTime.Today.ToString("dd/MM/yyyy") ,@readonly = true})
                                @Html.ValidationMessageFor(m => m.ReqDate, "", new { @class = "Error_Msg" })
                            </div>

                        </div>
                    </div>
                    <div class="row Form_Space_top">
                        <div class="form-group Form_Input">
                            <div class="col-md-1-5 col_cus_2 padding_rt">
                                <label>Operation Type:</label>
                            </div>
                            <div class="col-md-6">
                                <span class="ReQSimbol">*</span>
                                @Html.DropDownListFor(m => m.oprtntypId, new SelectList(ViewBag.lstOperationType, "oprtntypId", "OpertnType"), "---Select---", new { @class = "form-control input-sm", @onchange = "LoadContainer()" })
                                @*@Html.DropDownListFor(m => m.oprtntypId, (List<SelectListItem>)ViewBag.lstOperationType, new { @class = "form-control input-sm dropdown" })*@
                                @Html.ValidationMessageFor(m => m.oprtntypId, "", new { @class = "Error_Msg" })

                            </div>
                            <div class="col-md-1-5 col-md-offset-1 col_cus_2 col_cus_offset_0_5 padding_rt">
                                <label>Permission Date:</label>
                            </div>
                            <div class="col-md-2 col_cus_2_5 Date_Img">
                                @*<span class="ReQSimbol">*</span>*@
                                @Html.TextBoxFor(m => m.PermissionDate, new { @class = "form-control", placeholder = "dd/mm/yyyy", @id = "PermissionDate", Value = DateTime.Today.ToString("dd/MM/yyyy"), @readonly = true })
                                <div class="Error_Msg" id="errmsg2" style="background-color:transparent;color:red"></div>
                                @Html.ValidationMessageFor(m => m.PermissionDate, "", new { @class = "Error_Msg", @id = "PermissionDate" })
                            </div>
                        </div>
                    </div>
                    <div class="row Form_Space_top Form_Space_bottom">
                        <div class="form-group Form_Input">
                            <div class="col-md-1-5 col_cus_1_5">
                                @Html.LabelFor(m => m.ContainerNo, new { @class = "InputLabel" })<span class="LabelColon">:</span>
                            </div>
                            <div class="col-md-2-5 col_cus_2_5">
                                <span class="ReQSimbol">*</span>
                                @Html.TextBoxFor(m => m.ContainerNo, new { @class = "form-control", @readonly = true })
                                <span class="search" id="ContainerNoSearch"><i class="fa fa-search" aria-hidden="true" data-toggle="modal" data-target="#blNomodal"></i></span>
                                @Html.ValidationMessageFor(m => m.ContainerNo, "", new { @class = "Error_Msg" })
                            </div>
                            <div class="col-md-1-5 col_cus_1_5 col-md-offset-0-5">
                                <label class="InputLabel">CFS Code</label><span class="LabelColon">:</span>
                            </div>
                            <div class="col-md-2">
                                @Html.TextBoxFor(m => m.CFSCode, new { @class = "form-control input-sm", @readonly = "true" })
                                @*@Html.ValidationMessageFor(m => m.SpclOprtnReqNo, "", new { @class = "Error_Msg" })*@
                            </div>
                            <div class="col-md-1-5 col-md-offset-0-5">
                                @Html.Label("Size:")
                            </div>
                            <div class="col-md-2 col_cus_2_5">
                                @*<span class="ReQSimbol">*</span>*@
                                @Html.DropDownListFor(m => m.Size, new List<SelectListItem>
                               {
                                new SelectListItem { Text="20",Value="20"},
                                new SelectListItem { Text="40",Value="40"},
                                new SelectListItem { Text="45",Value="45"},
                                //new SelectListItem { Text="ODC",Value="ODC"},
                                }, "----Select----", new { @class = "form-control input-sm", @id = "Size" })
                                @Html.ValidationMessageFor(m => m.Size,"", new { @class = "Error_Msg" })
                            </div>
                        </div>
                    </div>

                    <div class="row Form_Space_top">
                        <div class="form-group Form_Input">
                            <div class="col-md-1-5 col_cus_1_5">
                                <label>Cargo Type:</label>
                            </div>
                            <div class="col-md-2-5 col_cus_2_5">
                                @*@Html.Hidden("CargoTypeh", new { @id = "CargoTypeh" })*@
                                @Html.DropDownListFor(m => m.CargoType, new List<SelectListItem>
                               {
                                new SelectListItem { Text="HAZ",Value="1"},
                                new SelectListItem { Text="NON-HAZ",Value="2"},
                                //new SelectListItem { Text="ODC",Value="ODC"},
                                }, "----Select----", new { @class = "form-control input-sm" })
                                @Html.ValidationMessage("txtSize", new { @class = "Error_Msg", @id = "CargoType" })
                                @*<select id="txtCargoType" name="txtCargoType">
                                        <option value="" selected>--Select--</option>
                                        <option value="1">HAZ</option>
                                        <option value="2">NON-HAZ</option>
                                    </select>*@
                            </div>

                            <div class="col-md-1-5 col_cus_1_5 col-md-offset-0-5">
                                @Html.Hidden("containerlassid", new { @id = "containerlassid " })
                                <label>Container Class:</label>
                            </div>
                            <div class="col-md-2">
                                @*<span class="ReQSimbol">*</span>*@
                                @Html.DropDownListFor(m => m.ContainerClass, new SelectList(ViewBag.lstContainerClass, "containerlassid", "CntainerClass"), "---Select---", new { @class = "form-control input-sm", @id = "CntainerClass" })
                                @*@Html.DropDownListFor(m => m.containerlassid, (List<SelectListItem>)ViewBag.lstContainerClass, new { @class = "form-control input-sm dropdown" })*@
                                @Html.ValidationMessageFor(m => m.ContainerClass, "", new { @class = "Error_Msg" })
                            </div>

                            <div class="col-md-1-5 col-md-offset-0-5">
                                <label>Export Type:</label>
                            </div>
                            <div class="col-md-2">
                                @*<span class="ReQSimbol">*</span>*@
                                @Html.DropDownListFor(m => m.cnttypeId, new SelectList(ViewBag.lstContainerType, "cnttypeId", "ContType"), "---Select---", new { @class = "form-control input-sm" })
                                @* @Html.DropDownListFor(m => m.cnttypeId, (List<SelectListItem>)ViewBag.lstContainerType, new { @class = "form-control input-sm dropdown" })*@
                                @*@Html.ValidationMessageFor(m => m.cnttypeId, "", new { @class = "Error_Msg" })*@
                            </div>
                        </div>
                    </div>
                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5 col_cus_2 padding_rt">
                                    <label>Shipping Line:</label>
                                </div>
                                @Html.Hidden("ShippingLineid ", new { @id = "ShippingLineid" })
                                <div class="col-md-10-5 col_cus_10">
                                    @* <span class="ReQSimbol">*</span>*@
                                    @Html.TextBoxFor(m => m.ShippingLine, "", new { @class = "form-control input-sm", @readonly = true, @id = "ShippingLine" })
                                    <span class="search"><i class="fa fa-search" aria-hidden="true" data-toggle="modal" data-target="#ShippingLineModal"></i></span>
                                    @Html.HiddenFor(m => m.ShippingLine)
                                    @Html.ValidationMessageFor(m => m.ShippingLine, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>

                        <div class="row Form_Space_top">
                            <div class="form-group Form_Input">
                                <div class="col-md-1-5">
                                    @Html.LabelFor(m => m.Remarks, new { @class = "InputLabel" })<span class="LabelColon">:</span>
                                </div>
                                <div class="col-md-10-5">
                                    @Html.TextAreaFor(m => m.Remarks, new { @class = "form-control intpu-sm", @style = "width:100%;height:50px;" , @maxlength = 500 })
                                    @Html.ValidationMessageFor(m => m.Remarks, "", new { @class = "Error_Msg" })
                                </div>
                            </div>
                        </div>


                        <div class="row">
                            <div class="stoke SignUp_space_top2 SignUp_space_bottom2"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-offset-4 col-md-2">
                                <input type="submit" id="btnSave" class="btn log_Btn_sm" value="Save" />
                            </div>
                            <div class="col-md-2">
                                <input type="button" id="btnReset" class="btn log_Btn_sm" value="Reset" onclick="ResetAllFields()" />
                            </div>
                        </div>
                        @*<div class="row" id="Back" style="display:none">
                                <div class="col-md-2 col-md-offset-5">
                                    <input type="button" value="Back" id="btnBack" class="btn log_Btn_sm" onclick="LoadGateExitView()" />
                                </div>
                            </div>*@

                        <div class="logSuccMsg Form_Space_top" id="DivMsg" style="background-color:transparent"></div>
                            <div class="logSuccMsg SignUp_space_bottom2" style="background-color:transparent">
                                <div id="DivExitThroughGateMsg" style="background-color:transparent"></div>
                            </div>
                }


                <div class="modal fade" id="blNomodal" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content popup_modal">
                            <div class="modal-header popup_header">
                                <button type="button" class="close" onclick="CloseContainer()"><i class="fa fa-times" aria-hidden="true"></i></button>
                                <h4 class="modal-title">List of Container</h4>
                            </div>
                            <div class="modal-body popup_body">
                                <input placeholder="Search By ContainerNo Or CFSCode" id="Containerbox" type="text" />
                                <span class="search" style="top: 18px;"><i class="fa fa-search" aria-hidden="true" onclick="SearchByCFSCode()"></i></span>

                                <table class="table table-striped table-bordered dataTable tblhd" style="width:100%; margin:0 !important; border-bottom:0; padding:0;">
                                    <thead>
                                        <tr>
                                            <th colspan="7" width="70%">ContainerNo</th>
                                            <th colspan="5" width="30%">CFSCode</th>
                                        </tr>
                                    </thead>
                                </table>
                                <div id="slim_scroll">
                                    <table class="table dataTable table-bordered table-striped slim_tble" id="tbleSline">
                                        @{
                                            if (ViewBag.lstContainer != null)
                                            {
                                                foreach (var item in ViewBag.lstContainer)
                                                {
                                                    <tr onclick="SelectContainer('@item.ContainerNo','@item.CFSCode','@item.Size','@item.ShippingLine','@item.ContainerClass','@item.CargoType','@item.ShippingLineId','@item.ExportType')">
                                                        <td colspan="7" width="70%" class="txt_wrp">@item.ContainerNo</td>
                                                        <td colspan="5" width="30%" class="txt_wrp">@item.CFSCode</td>
                                                        <td colspan="5" width="30%" class="txt_wrp" style="display:none;">@item.Size</td>
                                                        <td colspan="5" width="30%" class="txt_wrp" style="display:none;">@item.ShippingLine</td>
                                                        <td colspan="5" width="30%" class="txt_wrp" style="display:none;">@item.ContainerClass</td>
                                                        <td colspan="5" width="30%" class="txt_wrp" style="display:none;">@item.CargoType</td>
                                                        <td colspan="5" width="30%" class="txt_wrp" style="display:none;">@item.ShippingLineId</td>
                                                        <td colspan="5" width="30%" class="txt_wrp" style="display:none;">@item.ExportType</td>

                                                    </tr>
                                                }
                                            }
                                        }
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="row">
                                    <div class="col-md-6">
                                        @if (ViewBag.State != null && Convert.ToBoolean(ViewBag.State) == true)
                                        {
                                            <button type="button" style="width:100%; margin-left:0;" onclick="LoadMoreContainer()" class="btn log_Btn_sm" id="btnLoadMore">Load More Data</button>
                                        }
                                        else
                                        {
                                            <button type="button" style="width:100%; margin-left:0;" onclick="LoadMoreContainer()" class="btn log_Btn_sm" id="btnLoadMore" disabled>Load More Data</button>
                                        }
                                    </div>
                                    <div class="col-md-6">
                                        <button type="button" class="btn log_Btn_sm" onclick="CloseContainer()">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="ShippingLineModal" role="dialog">
                    <div class="modal-dialog">
                        <!-- Modal content-->
                        <div class="modal-content popup_modal">
                            <div class="modal-header popup_header">
                                <button type="button" class="close" onclick="CloseEximTrader()"><i class="fa fa-times" aria-hidden="true"></i></button>
                                <h4 class="modal-title">List of Shipping Line</h4>
                            </div>
                            <div class="modal-body popup_body" style="position:relative;">
                                <input placeholder="Search By Shipping Line Name Or Party Code" id="ShpngLinebox" type="text" />
                                <span class="search" style="top: 18px;"><i class="fa fa-search" aria-hidden="true" onclick="SearchByPartyCode()"></i></span>

                                <table class="table table-striped table-bordered dataTable tblhd" style="width:100%; margin:0 !important; border-bottom:0; padding:0;">
                                    <thead>
                                        <tr>
                                            <th colspan="8" width="80%">Shipping Line Name</th>
                                            <th colspan="4" width="20%">Party Code</th>
                                        </tr>
                                    </thead>
                                </table>

                                <div id="slim_scroll1">
                                    <table class="table dataTable table-bordered table-striped slim_tble" id="tbleSline1">
                                        @{
                                            if (ViewBag.lstShippingLine != null)
                                            {
                                                foreach (var item in ViewBag.lstShippingLine)
                                                {
                                                    <tr onclick="SelectShippingLine(@item.ShippingLineId,'@item.ShippingLineName')">
                                                        <td colspan="8" width="80%" class="txt_wrp">@item.ShippingLineName</td>
                                                        <td colspan="4" width="20%" class="txt_wrp">@item.PartyCode</td>
                                                    </tr>
                                                }
                                            }
                                        }
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="row">
                                    <div class="col-md-6">
                                        @if (ViewBag.State != null && Convert.ToBoolean(ViewBag.State) == true)
                                        {
                                            <button type="button" style="width:100%; margin-left:0;" onclick="LoadMoreEximTrader()" class="btn log_Btn_sm" id="btnLoadMore1">Load More Data</button>
                                        }
                                        else
                                        {
                                            <button type="button" style="width:100%; margin-left:0;" onclick="LoadMoreEximTrader()" class="btn log_Btn_sm" id="btnLoadMore1" disabled>Load More Data</button>
                                        }
                                    </div>
                                    <div class="col-md-6">
                                        <button type="button" class="btn log_Btn_sm" onclick="CloseEximTrader()">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="ContainerModal" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <!-- Modal content-->
                        <div class="modal-content popup_modal">
                            <div class="modal-header popup_header">
                                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times" aria-hidden="true"></i></button>
                                <h4 class="modal-title"> Entered Container</h4>
                            </div>
                            <div class="modal-body popup_body">
                                <input placeholder="Search Me" id="Containerbox" type="text" />
                                <ul class="navList" id="lstContainer">
                                    @{
                                        @*if (@ViewBag.Lstcontainer != null)
                                            {
                                                foreach (var item in @ViewBag.Lstcontainer)
                                                {
                                                    <li id="@item.ContainerName">@item.ContainerName</li>
                                                }
                                            }*@
                                    }
                                </ul>
                            </div>
                            <div class="modal-footer">
                                <div class="row">
                                    <div class="col-md-offset-6 col-md-6">
                                        <button type="button" class="btn log_Btn_sm" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-2 SignUp_space_bottom">
                        <input type="button" id="BtnEximTraderLoad" value="Show List" class="btn log_Btn_sm" onclick="GetSpecialOperationList()" />
                    </div>
                </div>
                <div class="row Form_Space_top Form_Space_bottom">
                    <div class="form-group Form_Input">
                        <div class="col-md-offset-5 col-md-4" style="text-align:right;">
                            <label>Container / CBT :</label>
                        </div>
                        <div class="col-md-3">
                            @Html.TextBox("containersearchtxt")
                            @*<input id="PartyCode" name="PartyCode" type="text" value="gfh gf">*@
                            <span class="search"><i class="fa fa-search" aria-hidden="true" onclick="LoadLoadedContainerRequestSearch()"></i></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div id="DivGateExitList"></div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>
@Scripts.Render("~/bundles/jqueryval")

<script type="text/javascript" src="/scripts/jquery.nicescroll.min.js"></script>
<script>
    $(function () {
        $('#slim_scroll').slimScroll({
            allowPageScroll: true
        });
    });
    $(function () {
        $('#slim_scroll1').slimScroll({
            allowPageScroll: true
        });
    });
</script>

<script type="text/javascript">

    function SelectShippingLine(ShippingLineId, ShippingLineName) {
        debugger;
        $('#ShippingLine').val(ShippingLineName);
        $('#ShippingLineid').val(ShippingLineId);
        $("#ShippingLineModal").modal("hide");
        $('#ShpngLinebox').val('');
        LoadEximTrader();
    }
    function LoadEximTrader() {
        debugger;
        Page = 0;
        $.ajax({
            url: '/Import/PpG_CWCImport/LoadEximtradeListForCustApr',
            type: 'GET',
            data: { PartyCode: "", Page: Page },
            success: function (data) {
                if (data.Status == 1) {
                    debugger;
                    var html = '';
                    $.each(data.Data.lstShippingLine, function (item, elem) {
                        debugger;
                        html += '<tr onclick="SelectShippingLine(' + elem.ShippingLineId + ',&quot;' + elem.ShippingLineName + '&quot;)"><td colspan="8" width="80%" class="txt_wrp">' + elem.ShippingLineName + '</td><td colspan="4" width="20%" class="txt_wrp">' + elem.PartyCode + '</td></tr>';
                    });
                    $('#tbleSline1 tbody').html(html);

                    if (data.Data.State == true)
                        $('#btnLoadMore1').prop('disabled', false);
                    else $('#btnLoadMore1').prop('disabled', true);
                }
            }
        });
    }
    function CloseEximTrader() {
        $('#ShpngLinebox').val('');
        $("#ShippingLineModal").modal("hide");
        LoadEximTrader();
    }
    function SearchByPartyCode() {
        if ($('#ShpngLinebox').val() != '') {
            $.ajax({
                url: '/Import/PpG_CWCImport/SearchByPartyCodeForCustApr',
                type: 'GET',
                data: { PartyCode: $('#ShpngLinebox').val() },
                success: function (data) {
                    if (data.Status == 1) {
                        var html = '';
                        $.each(data.Data.lstShippingLine, function (item, elem) {
                            html += '<tr onclick="SelectShippingLine(' + elem.ShippingLineId + ',&quot;' + elem.ShippingLineName + '&quot;)"><td colspan="8" width="80%" class="txt_wrp">' + elem.ShippingLineName + '</td><td colspan="4" width="20%" class="txt_wrp">' + elem.PartyCode + '</td></tr>';
                        });
                        $('#tbleSline1 tbody').html('');
                        $('#tbleSline1 tbody').html(html);
                        $('#btnLoadMore').prop('disabled', false);
                        Page = -1;
                    }
                    else {
                        $('#tbleSline1 tbody').html('');
                        Page = -1;
                        $('#btnLoadMore').prop('disabled', false);
                    }

                }
            });
        }
        else
            LoadEximTrader();
    }
    function LoadMoreEximTrader() {
        debugger;
        $.ajax({
            url: '/Import/PpG_CWCImport/LoadEximtradeListForCustApr',
            type: 'GET',
            data: { PartyCode: "", Page: Page + 1 },
            success: function (data) {
                if (data.Status == 1) {
                    debugger;
                    var html = '';
                    $.each(data.Data.lstShippingLine, function (item, elem) {
                        debugger;
                        html += '<tr onclick="SelectShippingLine(' + elem.ShippingLineId + ',&quot;' + elem.ShippingLineName + '&quot;)"><td colspan="8" width="80%" class="txt_wrp">' + elem.ShippingLineName + '</td><td colspan="4" width="20%" class="txt_wrp">' + elem.PartyCode + '</td></tr>';
                    });
                    if (Page == -1)
                        $('#tbleSline1 tbody').html(html);
                    else
                        $('#tbleSline1 tbody').append(html);
                    Page++;

                    if (data.Data.State == true)
                        $('#btnLoadMore1').prop('disabled', false);
                    else $('#btnLoadMore1').prop('disabled', true);
                }
            }
        });
    }
    document.getElementById('ShpngLinebox').addEventListener('keyup', debounce(function () {
        SearchByPartyCode();
    }, 800));

    function CargoSuccess(data) {
        $('#DivDwnldWavMsg').html('');
        if (data.Data != '') {
            window.open(data.Data + "?_t=" + new Date().getTime(), "_blank");
        }
        else $('#DivDwnldWavMsg').html('No Data');
    }
    function PVFailure() { }

    $('#Containerbox').keyup(function () {
        debugger;
        var val = $(this).val().toLowerCase();
        if (val == "")
            $('#lstContainer > li').show();
        else {
            $('#lstContainer > li').each(function () {
                var text = $(this).text().toLowerCase();
                (text.indexOf(val) >= 0 ? $(this).show() : $(this).hide());
            });
        }
    });

    function SelectContainer(ContainerNo, CFSCode, Size, ShippingLine, ContainerClass, CargoType, ShippingLineId, ExportType) {
        debugger;
        $('#ContainerNo').val(ContainerNo);
        $('#CFSCode').val(CFSCode);
        $('#CntainerClass').val(ContainerClass);
        $('#ShippingLine').val(ShippingLine);
        $('#ShippingLineid').val(ShippingLineId);
        $('#Size').val(Size);
        $('#cnttypeId').val(ExportType);
        if (ContainerClass == "")
            $('#containerlassid').val("1");
        else
            $('#containerlassid').val(ContainerClass);

        if (ExportType == "")
            $('#cnttypeId').val('');
        else
            $('#cnttypeId').val(ExportType);

        $('#CargoTypeh').val(CargoType);

        $('#CargoType').val(CargoType);
        // CntainerClass, ShippingLine, Size, CargoType
        $("#blNomodal").modal("hide");

        $('#Containerbox').val('');
        //LoadContainer();
    }
    function CloseContainer() {
        debugger;
        $('#Containerbox').val('');
        $("#blNomodal").modal("hide");
        LoadContainer();
    }
    $('#oprtntypId').change(function () {
        $('#CFSCode').val('');
        $('#ContainerNo').val('');
        $('#Size').val('');
        $('#ShippingLine').val('');
        $('#ShippingLineId').val('');
        $('#CargoType').val('');

    });
    $('#CntainerClass').change(function () {
        debugger;
        $('#containerlassid').val(this.options[this.selectedIndex].value)

    });
    var Page = 0;
    function LoadMoreContainer() {
        var OperationType = $('#oprtntypId').val();
        $('#ContainerNoSearch').show();
        debugger;
        $.ajax({
            url: '/Export/Dnode_CWCSpcloperationReq/LoadContainerList',
            type: 'GET',
            data: { OperationType: OperationType, CFSCode: "", Page: Page + 1 },
            success: function (data) {
                if (data.Status == 1) {
                    debugger;
                    var html = '';
                    $.each(data.Data.lstContainer, function (item, elem) {
                        debugger;
                        html += '<tr onclick="SelectContainer(&quot;' + elem.ContainerNo + '&quot;,&quot;' + elem.CFSCode + '&quot;,&quot;' + elem.Size + '&quot;,&quot;' + elem.ShippingLine + '&quot;,&quot;' + elem.ContainerClass + '&quot;,&quot;' + elem.CargoType + '&quot;,&quot;' + elem.ShippingLineId + '&quot;,&quot;' + elem.ExportType + '&quot;)"><td colspan="7" width="70%" class="txt_wrp">' + elem.ContainerNo + '</td><td colspan="5" width="30%" class="txt_wrp">' + elem.CFSCode + '</td></tr>';
                        //html += '<tr onclick="SelectContainer(&quot;' + elem.ContainerNo + '&quot;,&quot;' + elem.CFSCode + '&quot;)"><td colspan="7" width="70%" class="txt_wrp">' + elem.ContainerNo + '</td><td colspan="5" width="30%" class="txt_wrp">' + elem.CFSCode + '</td></tr>';
                    });
                    if (Page == -1)
                        $('#tbleSline tbody').html(html);
                    else
                        $('#tbleSline tbody').append(html);
                    Page++;

                    if (data.Data.State == true)
                        $('#btnLoadMore').prop('disabled', false);
                    else $('#btnLoadMore').prop('disabled', true);

                }
            }
        });
    }

    function LoadContainer() {
        debugger;
        Page = 0;
        //$('#ShippingLine').val('');
        //$('#ShippingLineid').val('');
        //$('#ContainerNo').val('');

        var OperationType = $('#oprtntypId').val();
        $('#ContainerNoSearch').show();
        $.ajax({
            url: '/Export/Dnode_CWCSpcloperationReq/LoadContainerList',
            type: 'GET',
            data: { CFSCode: "", OperationType: OperationType, Page: Page },
            success: function (data) {
                if (data.Status == 1) {
                    debugger;
                    var html = '';
                    $.each(data.Data.lstContainer, function (item, elem) {
                        debugger;
                        html += '<tr onclick="SelectContainer(&quot;' + elem.ContainerNo + '&quot;,&quot;' + elem.CFSCode + '&quot;,&quot;' + elem.Size + '&quot;,&quot;' + elem.ShippingLine + '&quot;,&quot;' + elem.ContainerClass + '&quot;,&quot;' + elem.CargoType + '&quot;,&quot;' + elem.ShippingLineId + '&quot;,&quot;' + elem.ExportType + '&quot;)"><td colspan="7" width="70%" class="txt_wrp">' + elem.ContainerNo + '</td><td colspan="5" width="30%" class="txt_wrp">' + elem.CFSCode + '</td></tr>';
                        //  html += '<tr onclick="SelectContainer(&quot;' + elem.ContainerNo + '&quot;,&quot;' + elem.CFSCode + '&quot;)"><td colspan="7" width="70%" class="txt_wrp">' + elem.ContainerNo + '</td><td colspan="5" width="30%" class="txt_wrp">' + elem.CFSCode + '</td></tr>';
                    });
                    $('#tbleSline tbody').html(html);

                    if (data.Data.State == true)
                        $('#btnLoadMore').prop('disabled', false);
                    else $('#btnLoadMore').prop('disabled', true);

                }
            }
        });

    }

    function SearchByCFSCode() {
        debugger;
        if ($('#Containerbox').val() != '') {
            $.ajax({
                url: '/Export/Dnode_CWCSpcloperationReq/SearchByCFSCode',
                type: 'GET',
                data: { CFSCode: $('#Containerbox').val() },
                success: function (data) {
                    debugger;
                    if (data.Status == 1) {
                        var html = '';
                        $.each(data.Data.lstContainer, function (item, elem) {
                            //html += '<tr onclick="SelectContainer(&quot;' + elem.ContainerNo + '&quot;,&quot;' + elem.CFSCode + '&quot;)"><td colspan="7" width="70%" class="txt_wrp">' + elem.ContainerNo + '</td><td colspan="5" width="30%" class="txt_wrp">' + elem.CFSCode + '</td></tr>';
                            html += '<tr onclick="SelectContainer(&quot;' + elem.ContainerNo + '&quot;,&quot;' + elem.CFSCode + '&quot;,&quot;' + elem.Size + '&quot;,&quot;' + elem.ShippingLine + '&quot;,&quot;' + elem.ContainerClass + '&quot;,&quot;' + elem.CargoType + '&quot;,&quot;' + elem.ShippingLineId + '&quot;,&quot;' + elem.ExportType + '&quot;)"><td colspan="7" width="70%" class="txt_wrp">' + elem.ContainerNo + '</td><td colspan="5" width="30%" class="txt_wrp">' + elem.CFSCode + '</td></tr>';
                        });
                        $('#tbleSline tbody').html('');
                        $('#tbleSline tbody').html(html);
                        $('#btnLoadMore').prop('disabled', false);
                        Page = -1;
                    }
                    else {
                        $('#tbleSline tbody').html('');
                        Page = -1;
                        $('#btnLoadMore').prop('disabled', false);
                    }

                }
            });
        }
        else
            LoadContainer();
    }

    function debounce(func, wait, immediate) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var later = function () {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    };
    document.getElementById('Containerbox').addEventListener('keyup', debounce(function () {
        SearchByCFSCode();
    }, 800));
    $(document).ready(function () {
        debugger;


        //   GetExitThroughGateList();

        //var editTime = $("#ReqDate").val();
        //alert(editTime);
        //if (editTime != null && editTime != "") {
        //    $("#time").val(editTime);
        //}

        $("#ReqDate").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });

        $("#PermissionDate").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: "/Content/images/calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date",
            changeMonth: true,
            changeYear: true,
            showAnima: "fadein",
            onClose: function () {
                $(".Date_Img .Error_Msg").text("");
                $('[data-valmsg-for="Data"]').html('<span></span>');
            }
        });


    });
</script>
<script>
    function GetSpecialOperationList() {
        $('#DivGateExitList').load('/Export/Dnode_CWCSpcloperationReq/SpclreqList');

    }
    function ResetAllFields() {
        $('#SpclOprtnReqId').val('');
        $('#SpclOprtnReqNo ').val('');
        $('#ContainerNo ').val('');
        $('#ReqDate ').val('');
        $('#CFSCode ').val('');
        $('#Size ').val('');
        $('#ShippingLine ').val('');
        $('#ShippingLineid ').val('');
        $('#PermissionDate ').val('');
        $('#CFSCode ').val('');
        $('#cnttypeId ').val('');
        $('#oprtntypId ').val('');
        $('#containerlassid ').val('');
        $('#CargoType ').val('');
        $('#Remarks ').val('');

        $('[data-valmsg-for]').html('<span><span>');
        // $('#TblCartingDetail').html('');
    }


    function LoadSpecialRequestPage() {
        $('#DivExitThroughGateMsg').html('');
        ResetAllFields();
        $('#DivBody').load('Export/Dnode_CWCSpcloperationReq/SpclOperationRequest');
    }
    //function WorkOrderOnSuccess(data) {
    //    if (data.Status == 1) {
    //        $('#DivWorkOrderMsg').html(data.Message);
    //        $('#CartingNoList #' + $('#CartingAppId').val()).remove();
    //        setTimeout(LoadSpecialRequestPage, TimeInSeconds);
    //        GetWorkOrderList();
    //    }
    //    else {
    //        $('#DivWorkOrderErrMsg').html(data.Message);
    //    }
    //}




    function GateExitOnSuccess(data) {
        debugger

        debugger;
        if (data.Status == 1 || data.Status == 2) {

            if ($('#DivExitThroughGateMsg').hasClass('logErrMsg'))
                $('#DivExitThroughGateMsg').removeClass('logErrMsg').addClass('logSuccMsg');
            $('#DivExitThroughGateMsg').html(data.Message);
            $('#SpclOprtnReqNo').val(data.Data);
            setTimeout(LoadSpecialRequestPage, TimeInSeconds);

            //  GetExitThroughGateList();
        }

        else {
            if ($('#DivExitThroughGateMsg').hasClass('logSuccMsg'))
                $('#DivExitThroughGateMsg').removeClass('logSuccMsg').addClass('logErrMsg');
            $('#DivExitThroughGateMsg').html(data.Message);
        }
    }
    function GateExitOnFailure() {       
        //alert("Error");
        //LoadGateExitView();
    }

    function ClearErrMsg(elem) {
        $('[data-valmsg-for="' + elem.id + '"]').html('');
    }

    function ValidateData(evt) {
        var CharCode;
        if (window.event) {
            CharCode = window.event.keyCode;
        }
        else {
            CharCode = evt.which;
        }
        if (CharCode == 32) {
            return true;
        }
        if ((CharCode > 31 & CharCode < 48) || (CharCode > 57 & CharCode < 65) || (CharCode > 90 & CharCode < 97) || (CharCode > 122)) {
            evt.preventDefault();
            return false;
        }
        return true;
    }

    function AllowOnlyInteger(evt) {
        var CharCode;
        if (window.event) {
            CharCode = window.event.keyCode;
        }
        else {
            CharCode = evt.which;
        }
        if ((CharCode > 47 & CharCode < 58) || CharCode == 8) {
            return true;
        }
        else {
            evt.preventDefault;
            return false;
        }
    }
    function AllowOnlyDecimal(evt) {
        var CharCode;
        if (window.event) {
            CharCode = window.event.keyCode;
        }
        else {
            CharCode = evt.which;
        }
        if ((CharCode > 47 & CharCode < 58) || (CharCode == 46) || CharCode == 8) {
            return true;
        }
        else {
            evt.preventDefault;
            return false;
        }
    }


    function GetContainer(elem) {

        $('#GatePassNo').val($(elem).text());
        $('#GatePassId').val($(elem).attr('id'));
        $("#GatePassModal").modal("hide");


        var gatepassID = $('#GatePassId').val();
        //alert("id" + $('#GatePassId').val());
        debugger;
        GetContaierAgainstGP(gatepassID);


    }

    //$('#btnSave').on("click", function () {
    //    //alert("clicked");
    //    debugger;
    //    var Status = true;
    //    //|| $('#txtCHAName').val() != "" || $('#txtCargoDescription').val() != "" || $('#txtCargoType').val() != "" || $('#txtVehicleNo').val() != "" ||
    //    //    $('#txtNoOfPackages').val() != "" || $('#txtGrossWeight').val() != "" || $('#txtDepositorName').val() != "" || $('#txtRemarks').val() != ""
    //    //if ($('#txtContainerNo').val() == ""  || $('#txtShippingLine').val() == ""  )
    //    //     {
    //    //    $('#DivMsg').html('Add The Record To Save');
    //    //    Status = false;
    //    //}
    //    //else {
    //    if ($('#tblExitThroughGateDet>tbody').html() == "" || $('#tblExitThroughGateDet>tbody').html() == undefined || $('#tblExitThroughGateDet>tbody').html() == null) {
    //        $('#DivMsg').html('Add The Record To Save');
    //        Status = false;
    //    }
    //    //}
    //    if (Status == true)

    //        var dtt = $('#GatePassDate').val();
    //    var dt = dtt.split("/");
    //    var dt1 = dt[2] + "-" + dt[1] + "-" + dt[0];

    //    $('#GatePassDate').val(dt1);
    //    dtt = $('#GateExitDateTime').val();

    //    dt = dtt.split("/");

    //    dt1 = dt[2] + "-" + dt[1] + "-" + dt[0];
    //    $('#GateExitDateTime').val(dt1);
    //    $('#StrExitThroughGateDetails').val(JSON.stringify(ArrayGateExitDet));
    //    //setTimeout(function () { $('#DivMsg').html(''); }, 5000);
    //    return Status;
    //});

    $('#btnSave').on("click", function () {
        debugger;
        if($('#oprtntypId').val()==5 || $('#oprtntypId').val()==6)
        {
            if ($('#cnttypeId').val() == "" || $('#cnttypeId').val() == "0" || $('#cnttypeId').val() == null)
            {
                alert("Select Export Type.");
                return false;
            }
        }
    });

    function LoadLoadedContainerRequestSearch() {

        debugger;
        if ($('#containersearchtxt').val().trim() == '') {
            alert('Enter Container/Request No. for searching');
            return;
        }
        $('#tblArrayContDet').html('');
        var containersearch = encodeURI($('#containersearchtxt').val().trim());
        // $('#CCINEntryList').empty();
        $('#DivGateExitList').load('/Export/Dnode_CWCSpcloperationReq/SpclreqListSearch?Search=' + containersearch);

    }
</script>
